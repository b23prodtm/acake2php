"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.get = exports.find = exports.update = exports.create = exports.getOrCreate = void 0;
const errors = require("./errors");
function getOrCreate(api, resource, body, filter) {
    return create(api, resource, body).catch((error) => {
        if (error instanceof errors.UniqueConstraintError) {
            return find(api, resource, { $filter: filter }).then((obj) => {
                if (obj.length > 0) {
                    return obj[0];
                }
                throw new errors.ObjectDoesNotExistError();
            });
        }
        throw error;
    });
}
exports.getOrCreate = getOrCreate;
function create(api, resource, body) {
    return api.post({ resource, body }).catch(wrapResponseError);
}
exports.create = create;
function update(api, resource, id, body) {
    return api.patch({ resource, id, body }).catch(wrapResponseError);
}
exports.update = update;
function find(api, resource, options) {
    return api.get({ resource, options }).catch(wrapResponseError);
}
exports.find = find;
function get(api, resource, id, expand) {
    let options;
    if (expand) {
        options = { $expand: expand };
    }
    return api.get({ resource, id, options }).catch(wrapResponseError);
}
exports.get = get;
function wrapResponseError(e) {
    const error = e;
    if (!error.statusCode) {
        throw e;
    }
    switch (error.statusCode) {
        case 400:
            throw new errors.BadRequestError(e);
        case 401:
            throw new errors.UnauthorisedError(e);
        case 404:
            throw new errors.ObjectDoesNotExistError(e);
        case 409:
            if (typeof error.message === 'string' && /unique/i.test(error.message)) {
                throw new errors.UniqueConstraintError(e);
            }
            throw new errors.ConflictError(e, error.statusCode);
        case 500:
            throw new errors.ServerError(e);
        default:
            throw new errors.HttpResponseError(e, error.statusCode);
    }
}
//# sourceMappingURL=models.js.map